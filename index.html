<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Electric Grid Visualisation and Analysis</title>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.4.2/css/ol.css" type="text/css">
    <link rel="stylesheet" href="./css/styles.css" type="text/css">
    <link rel="import" href="bower_components/px-modal/px-modal.html"/>
    <link rel="import" href="bower_components/px-file-upload/px-file-upload.html"/>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <script src="https://openlayers.org/en/v4.4.2/build/ol.js" type="text/javascript"></script>

</head>
<body>
<div id="header">
    <p id="header-text">Electric Grid Visualisation and Analysis</p>
</div>
<div id="map" class="map">
    <script src="index.js"></script>
</div>

<div id="popup" class="ol-popup">
    <a href="#" id="popup-closer" class="ol-popup-closer"></a>
    <div id="popup-content"></div>
</div>
<script>

    const container = document.getElementById('popup');
    const content = document.getElementById('popup-content');
    const closer = document.getElementById('popup-closer');

    const overlay = new ol.Overlay({
        element: container,
        autoPan: true,
        autoPanAnimation: {
            duration: 250
        }
    });

    closer.onclick = function() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
    };


    const map = new ol.Map({
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            }),
        ],
        overlays: [overlay],
        target: 'map',
        view: new ol.View({
            center: ol.proj.transform([-3.5, 50.74], 'EPSG:4326', 'EPSG:3857'),
            zoom: 13
        })
    });

    map.on('click', function(e) {
        let feature = map.forEachFeatureAtPixel(e.pixel, function(feat) {return feat;});

        if(feature) {
            content.innerHTML = '<p>Feature Type: ' + feature.get('type') + '</p>' + '<p>Feature ID: ' + feature.get('id') + '</p>';
            overlay.setPosition(e.coordinate);
        }
    });

    map.on("pointermove", function(e) {
        const hover = this.forEachFeatureAtPixel(e.pixel, function() {
            return true;
        });
        if (hover) {
            this.getTargetElement().style.cursor = 'pointer';
        } else {
            this.getTargetElement().style.cursor = '';
        }
    });
</script>

<div id="sidebar">
    <textarea name="infotext" id="infotext" disabled="disabled">The map on the left hand side is fully interactive and displays the GeoJSON data that you uploaded. The buttons below enable you to filter the data as and how you like.
    </textarea>
    <div id="buttons">
        <button id="transformers">Show Transformers</button>
        <br/>
        <button id="cables">Show Cables</button>
        <br/>
        <button id="substations">Show Substations</button>
    </div>

    <div id="network-info">
        <p id="total-features" class="info"></p>
        <p id="total-gen-stations" class="info"></p>
        <p id="total-cables" class="info"></p>
        <p id="total-service-points" class="info"></p>
    </div>

    <div id="real-time-data-button">
        <button id="real-time-data-upload" onclick="realTimeDataUpload()">Upload Real-Time Data</button>
    </div>

</div>

<div id="footer">
    <p id="footer-text">Vladislav Romanov (University of Exeter)</p>
</div>


<px-modal
        id="welcome-modal"
        modal-heading="Welcome to the Electric Grid Analysis web application"
        btn-modal-positive="Upload">
    <px-file-upload accept=".geojson"></px-file-upload>
</px-modal>

<px-modal
        id="real-time-data-modal"
        modal-heading="Upload your network's real-time JSON data"
        btn-modal-positive="Upload">
    <px-file-upload accept=".json"></px-file-upload>
</px-modal>

</body>

</html>